<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tampa Bay Industrial | Lee &amp; Associates</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--navy:#002855;--white:#FFFFFF;--red:#C8102E;--light-gray:#F4F5F7;--medium-gray:#6B7280;--dark-text:#1A1A2E;--shadow:0 2px 12px rgba(0,40,85,0.08);--border:1px solid rgba(0,40,85,0.1);--radius-card:8px;--radius-popup:12px;--transition:0.25s ease}
html,body{height:100%;overflow:hidden}
body{font-family:'DM Sans','Segoe UI',sans-serif;color:var(--dark-text);background:var(--light-gray)}
.app{display:flex;height:100vh}
.sidebar{width:380px;min-width:380px;display:flex;flex-direction:column;background:var(--white);border-right:var(--border);box-shadow:2px 0 20px rgba(0,40,85,0.06);z-index:1000}
.map-container{flex:1;position:relative}
#map{width:100%;height:100%}
.sidebar-header{background:var(--navy);padding:20px 24px;color:var(--white)}
.logo-row{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.logo-row img{height:32px;filter:brightness(0) invert(1)}
.logo-text{font-family:'DM Sans',sans-serif;font-weight:600;font-size:13px;letter-spacing:2.5px;text-transform:uppercase;opacity:0.85}
.sidebar-header h1{font-family:'Playfair Display',Georgia,serif;font-size:20px;font-weight:700;line-height:1.3;margin-bottom:4px}
.sidebar-header .subtitle{font-size:13px;opacity:0.7;font-weight:400}
.filters{padding:14px 20px;border-bottom:var(--border);background:var(--white)}
.filter-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;color:var(--medium-gray);margin-bottom:8px}
.filter-pills{display:flex;flex-wrap:wrap;gap:6px}
.filter-pill{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:500;cursor:pointer;border:1.5px solid rgba(0,40,85,0.15);background:var(--white);color:var(--dark-text);transition:all var(--transition);user-select:none}
.filter-pill:hover{border-color:var(--navy);background:rgba(0,40,85,0.04)}
.filter-pill.active{background:var(--navy);color:var(--white);border-color:var(--navy)}
.filter-pill.active:hover{background:#003670}
.property-list{flex:1;overflow-y:auto;padding:8px 0}
.property-list::-webkit-scrollbar{width:5px}
.property-list::-webkit-scrollbar-track{background:transparent}
.property-list::-webkit-scrollbar-thumb{background:rgba(0,40,85,0.15);border-radius:10px}
.property-card{padding:14px 20px 14px 24px;border-bottom:var(--border);cursor:pointer;transition:all var(--transition);position:relative}
.property-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:transparent;transition:background var(--transition);border-radius:0 3px 3px 0}
.property-card:hover{background:rgba(0,40,85,0.02)}
.property-card:hover::before{background:var(--red)}
.property-card.active{background:rgba(200,16,46,0.04)}
.property-card.active::before{background:var(--red)}
.property-card.filtered-out{display:none}
.card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px;gap:8px}
.card-name{font-weight:600;font-size:14px;color:var(--dark-text);line-height:1.3}
.card-badge{font-size:10px;font-weight:600;padding:3px 8px;border-radius:4px;background:rgba(0,40,85,0.08);color:var(--navy);white-space:nowrap;letter-spacing:0.3px}
.card-address{font-size:12.5px;color:var(--medium-gray);margin-bottom:8px}
.card-metrics{display:flex;gap:16px}
.card-metric-value{font-weight:600;font-size:12px;color:var(--dark-text)}
.card-metric-label{color:var(--medium-gray);font-size:10.5px}
.summary-stats{padding:16px 20px;background:var(--navy);color:var(--white);display:grid;grid-template-columns:repeat(3,1fr);gap:2px}
.stat-item{text-align:center;padding:8px 4px}
.stat-value{font-family:'Playfair Display',Georgia,serif;font-size:20px;font-weight:700}
.stat-label{font-size:10px;text-transform:uppercase;letter-spacing:1px;opacity:0.65;margin-top:2px}
.empty-state{padding:40px 20px;text-align:center;color:var(--medium-gray);display:none}
.empty-state.visible{display:block}
.empty-state p{font-size:14px;line-height:1.5}
.leaflet-popup-content-wrapper{border-radius:var(--radius-popup)!important;box-shadow:0 8px 30px rgba(0,40,85,0.15)!important;padding:0!important;overflow:hidden}
.leaflet-popup-content{margin:0!important;width:340px!important;font-family:'DM Sans',sans-serif!important}
.leaflet-popup-tip{box-shadow:0 4px 12px rgba(0,40,85,0.1)!important}
.popup-image{width:100%;height:140px;background:linear-gradient(135deg,#002855 0%,#003d7a 50%,#002855 100%);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.popup-image::after{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' fill='none' stroke='rgba(255,255,255,0.12)' stroke-width='1.5'%3E%3Crect x='10' y='25' width='60' height='45' rx='2'/%3E%3Crect x='20' y='10' width='40' height='60' rx='2'/%3E%3Cline x1='30' y1='20' x2='30' y2='30'/%3E%3Cline x1='40' y1='20' x2='40' y2='30'/%3E%3Cline x1='50' y1='20' x2='50' y2='30'/%3E%3Cline x1='30' y1='35' x2='30' y2='45'/%3E%3Cline x1='40' y1='35' x2='40' y2='45'/%3E%3Cline x1='50' y1='35' x2='50' y2='45'/%3E%3Cline x1='30' y1='50' x2='30' y2='60'/%3E%3Cline x1='40' y1='50' x2='40' y2='60'/%3E%3Cline x1='50' y1='50' x2='50' y2='60'/%3E%3C/svg%3E") center center no-repeat}
.popup-image img{width:100%;height:100%;object-fit:cover}
.popup-body{padding:16px 18px}
.popup-type-badge{display:inline-block;font-size:10px;font-weight:600;padding:3px 8px;border-radius:4px;background:rgba(0,40,85,0.08);color:var(--navy);letter-spacing:0.3px;margin-bottom:6px}
.popup-name{font-family:'Playfair Display',Georgia,serif;font-size:17px;font-weight:700;color:var(--dark-text);margin-bottom:2px;line-height:1.3}
.popup-address{font-size:12.5px;color:var(--medium-gray);margin-bottom:12px}
.popup-summary{font-size:12.5px;line-height:1.55;color:#4a4a5a;margin-bottom:14px;font-style:italic;border-left:3px solid var(--red);padding-left:12px}
.popup-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:rgba(0,40,85,0.06);border-radius:6px;overflow:hidden;margin-bottom:12px}
.popup-grid-item{background:var(--white);padding:10px 8px;text-align:center}
.popup-grid-value{font-size:14px;font-weight:700;color:var(--dark-text)}
.popup-grid-label{font-size:10px;color:var(--medium-gray);text-transform:uppercase;letter-spacing:0.5px;margin-top:2px}
.popup-details{font-size:12px;color:var(--medium-gray);line-height:1.6;margin-bottom:12px}
.popup-details span{color:var(--dark-text);font-weight:500}
.popup-notes{font-size:12px;line-height:1.5;color:#4a4a5a;background:var(--light-gray);padding:10px 12px;border-radius:6px;margin-bottom:14px}
.popup-notes-label{font-weight:600;font-size:10px;text-transform:uppercase;letter-spacing:0.8px;color:var(--medium-gray);margin-bottom:4px}
.popup-footer{border-top:var(--border);padding-top:12px;display:flex;justify-content:space-between;align-items:center}
.popup-footer-brand{font-size:11px;color:var(--medium-gray);font-weight:500}
.popup-footer-cta{font-size:12px;font-weight:600;color:var(--red);text-decoration:none;cursor:pointer;transition:opacity var(--transition)}
.popup-footer-cta:hover{opacity:0.75}
.custom-marker{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;background:var(--navy);border:2.5px solid var(--white);box-shadow:0 2px 8px rgba(0,40,85,0.3);color:var(--white);font-size:12px;font-weight:700;font-family:'DM Sans',sans-serif;transition:all var(--transition)}
.custom-marker:hover,.custom-marker.active{background:var(--red);transform:scale(1.15);box-shadow:0 4px 14px rgba(200,16,46,0.35)}
.custom-marker.faded{opacity:0.3;pointer-events:none}
.marker-cluster-small,.marker-cluster-medium,.marker-cluster-large{background:rgba(0,40,85,0.15)!important}
.marker-cluster-small div,.marker-cluster-medium div,.marker-cluster-large div{background:var(--navy)!important;color:var(--white)!important;font-family:'DM Sans',sans-serif!important;font-weight:600!important;font-size:13px!important}
@keyframes pinDrop{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15);opacity:1}100%{transform:scale(1);opacity:1}}
.pin-animate{animation:pinDrop 0.4s ease-out forwards}
.mobile-bottom-card,.mobile-list-btn,.mobile-list-overlay{display:none}
@media(max-width:768px){
.app{flex-direction:column}
.sidebar{width:100%;min-width:unset;height:auto;border-right:none;border-bottom:var(--border);flex-shrink:0;box-shadow:none}
.map-container{flex:1;min-height:0}
.sidebar-header{padding:10px 16px}
.logo-row{margin-bottom:4px}
.logo-row img{height:24px}
.logo-text{font-size:11px;letter-spacing:2px}
.sidebar-header h1{font-size:16px;margin-bottom:2px}
.sidebar-header .subtitle{font-size:11px;margin-bottom:0}
.filters{padding:8px 16px}
.filter-label{display:none}
.filter-pills{flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding-bottom:2px}
.filter-pills::-webkit-scrollbar{display:none}
.filter-pill{min-height:36px;padding:8px 16px;white-space:nowrap;flex-shrink:0;display:flex;align-items:center}
.property-list,.empty-state,.summary-stats{display:none!important}
.leaflet-control-zoom{display:none!important}
.leaflet-popup{display:none!important}
.custom-marker{width:40px;height:40px;font-size:13px}
.mobile-bottom-card{display:block;position:fixed;bottom:0;left:0;right:0;max-height:55vh;background:var(--white);border-radius:16px 16px 0 0;box-shadow:0 -4px 30px rgba(0,40,85,0.2);z-index:1001;transform:translateY(100%);transition:transform 0.3s ease;pointer-events:none;overflow:hidden}
.mobile-bottom-card.visible{transform:translateY(0);pointer-events:auto}
.mobile-bottom-card-close{position:absolute;top:8px;right:8px;width:44px;height:44px;background:rgba(0,0,0,0.5);color:var(--white);border:none;border-radius:50%;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;line-height:1}
.mobile-bottom-card-content{overflow-y:auto;max-height:55vh;-webkit-overflow-scrolling:touch}
.mobile-bottom-card-content .popup-image{height:100px}
.mobile-bottom-card-content .popup-body{padding:12px 16px}
.mobile-bottom-card-content .popup-name{font-size:15px}
.mobile-bottom-card-content .popup-summary{font-size:12px;margin-bottom:10px}
.mobile-bottom-card-content .popup-grid{margin-bottom:10px}
.mobile-bottom-card-content .popup-grid-item{padding:8px 6px}
.mobile-bottom-card-content .popup-grid-value{font-size:13px}
.mobile-list-btn{display:flex;position:fixed;bottom:20px;right:20px;height:48px;padding:0 20px;background:var(--navy);color:var(--white);border:none;border-radius:24px;box-shadow:0 4px 16px rgba(0,40,85,0.35);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;align-items:center;gap:8px;z-index:1000;transition:transform var(--transition)}
.mobile-list-btn:active{transform:scale(0.95)}
.mobile-list-btn.hidden{display:none!important}
.mobile-list-overlay{display:flex;position:fixed;top:0;left:0;right:0;bottom:0;background:var(--white);z-index:1002;flex-direction:column;transform:translateY(100%);transition:transform 0.3s ease;pointer-events:none}
.mobile-list-overlay.visible{transform:translateY(0);pointer-events:auto}
.mobile-list-overlay-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--navy);color:var(--white);flex-shrink:0}
.mobile-list-overlay-header h2{font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700}
.mobile-list-overlay-close{width:44px;height:44px;background:transparent;color:var(--white);border:none;font-size:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1}
.mobile-list-overlay-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:rgba(0,40,85,0.06);flex-shrink:0}
.mobile-list-overlay-stats .stat-item{background:var(--white);text-align:center;padding:10px 4px}
.mobile-list-overlay-stats .stat-value{font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700;color:var(--navy)}
.mobile-list-overlay-stats .stat-label{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--medium-gray);margin-top:2px}
.mobile-list-overlay-filters{padding:8px 16px;border-bottom:var(--border);flex-shrink:0;overflow-x:auto;-webkit-overflow-scrolling:touch;display:flex;gap:6px;scrollbar-width:none}
.mobile-list-overlay-filters::-webkit-scrollbar{display:none}
.mobile-list-overlay-filters .filter-pill{min-height:36px;padding:8px 16px;white-space:nowrap;flex-shrink:0;display:inline-flex;align-items:center}
.mobile-list-overlay-list{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
.mobile-list-overlay-list .property-card{display:block!important;padding:14px 16px}
}
@media print{.sidebar{display:none}.map-container{width:100%;height:100vh}.leaflet-control-zoom{display:none!important}}
</style>
</head>
<body>
<div class="app">
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="logo-row">
      <img src="https://www.lee-associates.com/wp-content/themes/leeassoc2017/images/lee_and_associates_logo.svg" alt="Lee &amp; Associates" onerror="this.style.display='none'">
      <span class="logo-text">Chicago Suburban</span>
    </div>
    <h1>Tampa Bay Industrial</h1>
    <div class="subtitle">Q1 2026 Market Overview â€¢ 23 Properties</div>
  </div>
  <div class="filters">
    <div class="filter-label">Filter by County</div>
    <div class="filter-pills" id="filterPills">
      <div class="filter-pill active" data-filter="all">All</div>
    </div>
  </div>
  <div class="property-list" id="propertyList"></div>
  <div class="empty-state" id="emptyState">
    <p>No properties match this filter.<br>Try selecting a different county.</p>
  </div>
  <div class="summary-stats" id="summaryStats">
    <div class="stat-item"><div class="stat-value" id="statCount">23</div><div class="stat-label">Properties</div></div>
    <div class="stat-item"><div class="stat-value" id="statSF">2,311,000</div><div class="stat-label">Total RBA</div></div>
    <div class="stat-item"><div class="stat-value" id="statAcres">159.3</div><div class="stat-label">Total Acres</div></div>
  </div>
</aside>
<div class="map-container"><div id="map"></div></div>
</div>
<div id="mobileBottomCard" class="mobile-bottom-card">
  <button id="mobileBottomCardClose" class="mobile-bottom-card-close" aria-label="Close">&times;</button>
  <div id="mobileBottomCardContent" class="mobile-bottom-card-content"></div>
</div>
<button id="mobileListBtn" class="mobile-list-btn" aria-label="View property list">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
  List
</button>
<div id="mobileListOverlay" class="mobile-list-overlay">
  <div class="mobile-list-overlay-header">
    <h2>Properties</h2>
    <button id="mobileListOverlayClose" class="mobile-list-overlay-close" aria-label="Close">&times;</button>
  </div>
  <div class="mobile-list-overlay-stats" id="mobileOverlayStats"></div>
  <div class="mobile-list-overlay-filters" id="mobileOverlayFilters"></div>
  <div class="mobile-list-overlay-list" id="mobileOverlayList"></div>
</div>
<script>
const PROPERTIES = [
  {
    "name": "Tampa East Distribution Center",
    "address": "6210 E Hillsborough Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33610",
    "submarket": "East Tampa",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 150000,
    "available_sf": 14179,
    "vacancy_rate": "9.5%",
    "asking_rent": "$12.62",
    "year_built": 1993,
    "stories": 1,
    "lot_size": 8.6,
    "clear_height": 24,
    "dock_doors": 12,
    "drive_in_doors": 3,
    "zoning": "PD",
    "parking": 86,
    "owner": "Prologis",
    "broker_notes": "Recently renovated dock area. Owner motivated on long-term lease.",
    "latitude": 27.996146,
    "longitude": -82.4053506,
    "summary": "A sizable office property (8.6-acre, 150,000 SF) in Tampa (East Tampa County). Recently renovated dock area. Owner motivated on long-term lease."
  },
  {
    "name": "Seffner Logistics Hub",
    "address": "702 S Kingsway Rd",
    "city": "Seffner",
    "state": "FL",
    "zip": "33584",
    "submarket": "East Tampa",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 35000,
    "available_sf": 4810,
    "vacancy_rate": "13.7%",
    "asking_rent": "$10.67",
    "year_built": 2019,
    "stories": 1,
    "lot_size": 2.3,
    "clear_height": 32,
    "dock_doors": 2,
    "drive_in_doors": 2,
    "zoning": "M-2",
    "parking": 20,
    "owner": "Terreno Realty",
    "broker_notes": "New roof installed 2024. Energy-efficient HVAC upgrade.",
    "latitude": 27.9900536,
    "longitude": -82.277572,
    "summary": "An office property (2.3-acre, 35,000 SF) in Seffner (East Tampa County). New roof installed 2024. Energy-efficient HVAC upgrade."
  },
  {
    "name": "Progress Corporate Park Bldg 12",
    "address": "5806 Breckenridge Pkwy",
    "city": "Tampa",
    "state": "FL",
    "zip": "33610",
    "submarket": "East Tampa",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 55000,
    "available_sf": 6170,
    "vacancy_rate": "11.2%",
    "asking_rent": "$14.4",
    "year_built": 1990,
    "stories": 1,
    "lot_size": 3.2,
    "clear_height": 32,
    "dock_doors": 2,
    "drive_in_doors": 2,
    "zoning": "CI",
    "parking": 65,
    "owner": "Prologis",
    "broker_notes": "Food-grade certified. Temperature-controlled zones available.",
    "latitude": 27.9985,
    "longitude": -82.377,
    "summary": "An office property (3.2-acre, 55,000 SF) in Tampa (East Tampa County). Food-grade certified. Temperature-controlled zones available."
  },
  {
    "name": "Netpark Tampa Bay",
    "address": "5020 W Linebaugh Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33624",
    "submarket": "North Tampa",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 85000,
    "available_sf": 22481,
    "vacancy_rate": "26.4%",
    "asking_rent": "$14.53",
    "year_built": 2020,
    "stories": 1,
    "lot_size": 5.4,
    "clear_height": 30,
    "dock_doors": 8,
    "drive_in_doors": 3,
    "zoning": "IG",
    "parking": 88,
    "owner": "Suncoast Ventures",
    "broker_notes": "Strong access to I-4 and I-75 interchange. 24/7 security.",
    "latitude": 28.0397113,
    "longitude": -82.481504,
    "summary": "An office property (5.4-acre, 85,000 SF) in Tampa (North Tampa County). Strong access to I-4 and I-75 interchange. 24/7 security."
  },
  {
    "name": "Airport Industrial Center",
    "address": "4702 Transport Dr",
    "city": "Tampa",
    "state": "FL",
    "zip": "33605",
    "submarket": "Westshore/Airport",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 30000,
    "available_sf": 9435,
    "vacancy_rate": "31.5%",
    "asking_rent": "$12.88",
    "year_built": 1991,
    "stories": 1,
    "lot_size": 1.9,
    "clear_height": 32,
    "dock_doors": 3,
    "drive_in_doors": 2,
    "zoning": "IL",
    "parking": 31,
    "owner": "CenterPoint Properties",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 27.968,
    "longitude": -82.442,
    "summary": "An office property (1.9-acre, 30,000 SF) in Tampa (Westshore/Airport County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Westshore Commerce Park",
    "address": "5409 Mariner St",
    "city": "Tampa",
    "state": "FL",
    "zip": "33609",
    "submarket": "Westshore/Airport",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 150000,
    "available_sf": 23518,
    "vacancy_rate": "15.7%",
    "asking_rent": "$14.23",
    "year_built": 2023,
    "stories": 1,
    "lot_size": 11.1,
    "clear_height": 28,
    "dock_doors": 10,
    "drive_in_doors": 3,
    "zoning": "IL",
    "parking": 134,
    "owner": "Hillsborough Holdings LP",
    "broker_notes": "Food-grade certified. Temperature-controlled zones available.",
    "latitude": 27.9434393,
    "longitude": -82.5348661,
    "summary": "A sizable office property (11.1-acre, 150,000 SF) in Tampa (Westshore/Airport County). Food-grade certified. Temperature-controlled zones available."
  },
  {
    "name": "Port Tampa Warehouse A",
    "address": "5101 Channelside Dr",
    "city": "Tampa",
    "state": "FL",
    "zip": "33602",
    "submarket": "Westshore/Airport",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 100000,
    "available_sf": 13784,
    "vacancy_rate": "13.8%",
    "asking_rent": "$9.18",
    "year_built": 1999,
    "stories": 1,
    "lot_size": 7.3,
    "clear_height": 24,
    "dock_doors": 7,
    "drive_in_doors": 2,
    "zoning": "M-2",
    "parking": 77,
    "owner": "CenterPoint Properties",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 27.9419146,
    "longitude": -82.4576459,
    "summary": "A sizable office property (7.3-acre, 100,000 SF) in Tampa (Westshore/Airport County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Kennedy Industrial Plaza",
    "address": "7007 W Courtney Campbell Cswy",
    "city": "Tampa",
    "state": "FL",
    "zip": "33607",
    "submarket": "Westshore/Airport",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 150000,
    "available_sf": 37453,
    "vacancy_rate": "25.0%",
    "asking_rent": "$13.8",
    "sale_price": "$18,900,000",
    "cap_rate": "5.93%",
    "year_built": 1993,
    "stories": 1,
    "lot_size": 9.8,
    "clear_height": 28,
    "dock_doors": 13,
    "drive_in_doors": 3,
    "zoning": "PD",
    "parking": 170,
    "owner": "Tampa Bay Industrial LLC",
    "broker_notes": "Heavy power available (2,000 amps). Reinforced slab floor.",
    "latitude": 27.9645,
    "longitude": -82.553,
    "summary": "A sizable office property (9.8-acre, 150,000 SF) in Tampa (Westshore/Airport County). Heavy power available (2,000 amps). Reinforced slab floor."
  },
  {
    "name": "Ybor Gateway Warehouse",
    "address": "2001 N 20th St",
    "city": "Tampa",
    "state": "FL",
    "zip": "33605",
    "submarket": "Ybor/Port",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 62000,
    "available_sf": 8539,
    "vacancy_rate": "13.8%",
    "asking_rent": "$14.73",
    "sale_price": "$7,254,000",
    "cap_rate": "5.77%",
    "year_built": 1988,
    "stories": 1,
    "lot_size": 4.8,
    "clear_height": 24,
    "dock_doors": 3,
    "drive_in_doors": 3,
    "zoning": "M-1",
    "parking": 74,
    "owner": "Duke Realty",
    "broker_notes": "Heavy power available (2,000 amps). Reinforced slab floor.",
    "latitude": 27.961787,
    "longitude": -82.436657,
    "summary": "An office property (4.8-acre, 62,000 SF) in Tampa (Ybor/Port County). Heavy power available (2,000 amps). Reinforced slab floor."
  },
  {
    "name": "Adamo Commerce Center",
    "address": "3402 E 7th Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33605",
    "submarket": "Ybor/Port",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 75000,
    "available_sf": 21626,
    "vacancy_rate": "28.8%",
    "asking_rent": "$10.36",
    "year_built": 1992,
    "stories": 1,
    "lot_size": 5.3,
    "clear_height": 36,
    "dock_doors": 4,
    "drive_in_doors": 3,
    "zoning": "IG",
    "parking": 55,
    "owner": "Rexford Industrial",
    "broker_notes": "Recently renovated dock area. Owner motivated on long-term lease.",
    "latitude": 27.9602978,
    "longitude": -82.4222019,
    "summary": "An office property (5.3-acre, 75,000 SF) in Tampa (Ybor/Port County). Recently renovated dock area. Owner motivated on long-term lease."
  },
  {
    "name": "Port Redwing Terminal",
    "address": "1103 Channelside Dr",
    "city": "Tampa",
    "state": "FL",
    "zip": "33602",
    "submarket": "Ybor/Port",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 180000,
    "available_sf": 72061,
    "vacancy_rate": "40.0%",
    "asking_rent": "$8.67",
    "year_built": 2017,
    "stories": 1,
    "lot_size": 12,
    "clear_height": 24,
    "dock_doors": 11,
    "drive_in_doors": 3,
    "zoning": "IL",
    "parking": 140,
    "owner": "Bay Area Industrial Trust",
    "broker_notes": "Fully sprinklered, ESFR system. LED lighting throughout.",
    "latitude": 27.9515422,
    "longitude": -82.4454496,
    "summary": "A sizable office property (12.0-acre, 180,000 SF) in Tampa (Ybor/Port County). Fully sprinklered, ESFR system. LED lighting throughout."
  },
  {
    "name": "Northpointe Business Park",
    "address": "14310 N Nebraska Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33613",
    "submarket": "North Tampa",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 100000,
    "available_sf": 43139,
    "vacancy_rate": "43.1%",
    "asking_rent": "$14.11",
    "year_built": 2023,
    "stories": 1,
    "lot_size": 7.9,
    "clear_height": 30,
    "dock_doors": 9,
    "drive_in_doors": 1,
    "zoning": "IG",
    "parking": 96,
    "owner": "Prologis",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 27.9519962,
    "longitude": -82.4512855,
    "summary": "A sizable office property (7.9-acre, 100,000 SF) in Tampa (North Tampa County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Tampa Commerce Center",
    "address": "8717 N Himes Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33614",
    "submarket": "North Tampa",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 120000,
    "available_sf": 51453,
    "vacancy_rate": "42.9%",
    "asking_rent": "$7.21",
    "year_built": 2019,
    "stories": 1,
    "lot_size": 8.1,
    "clear_height": 28,
    "dock_doors": 4,
    "drive_in_doors": 3,
    "zoning": "IL",
    "parking": 130,
    "owner": "EastGroup Properties",
    "broker_notes": "Immediate occupancy. Previously occupied by national logistics tenant.",
    "latitude": 27.9891895,
    "longitude": -82.5010916,
    "summary": "A sizable office property (8.1-acre, 120,000 SF) in Tampa (North Tampa County). Immediate occupancy. Previously occupied by national logistics tenant."
  },
  {
    "name": "Waters Ave Industrial Complex",
    "address": "7450 W Waters Ave",
    "city": "Tampa",
    "state": "FL",
    "zip": "33615",
    "submarket": "North Tampa",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 120000,
    "available_sf": 26310,
    "vacancy_rate": "21.9%",
    "asking_rent": "$8.25",
    "year_built": 2004,
    "stories": 1,
    "lot_size": 8.4,
    "clear_height": 32,
    "dock_doors": 12,
    "drive_in_doors": 3,
    "zoning": "IH",
    "parking": 126,
    "owner": "Industrial Logistics Properties Trust",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 28.0253059,
    "longitude": -82.4847917,
    "summary": "A sizable office property (8.4-acre, 120,000 SF) in Tampa (North Tampa County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Riverview Distribution Facility",
    "address": "7320 FishHawk Blvd",
    "city": "Riverview",
    "state": "FL",
    "zip": "33578",
    "submarket": "South Hillsborough",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 35000,
    "available_sf": 6483,
    "vacancy_rate": "18.5%",
    "asking_rent": "$11.35",
    "year_built": 1985,
    "stories": 1,
    "lot_size": 2.8,
    "clear_height": 24,
    "dock_doors": 2,
    "drive_in_doors": 1,
    "zoning": "IH",
    "parking": 21,
    "owner": "EastGroup Properties",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 27.855,
    "longitude": -82.212,
    "summary": "An office property (2.8-acre, 35,000 SF) in Riverview (South Hillsborough County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Brandon Crossroads Warehouse",
    "address": "910 Lithia Pinecrest Rd",
    "city": "Brandon",
    "state": "FL",
    "zip": "33511",
    "submarket": "South Hillsborough",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 55000,
    "available_sf": 17467,
    "vacancy_rate": "31.8%",
    "asking_rent": "$8.27",
    "sale_price": "$5,115,000",
    "cap_rate": "6.23%",
    "year_built": 2015,
    "stories": 1,
    "lot_size": 4.4,
    "clear_height": 32,
    "dock_doors": 3,
    "drive_in_doors": 1,
    "zoning": "PD",
    "parking": 54,
    "owner": "Terreno Realty",
    "broker_notes": "Signage opportunity on major corridor. High visibility.",
    "latitude": 27.9254715,
    "longitude": -82.272563,
    "summary": "An office property (4.4-acre, 55,000 SF) in Brandon (South Hillsborough County). Signage opportunity on major corridor. High visibility."
  },
  {
    "name": "Gateway Logistics Park",
    "address": "10150 Highland Manor Dr",
    "city": "Tampa",
    "state": "FL",
    "zip": "33610",
    "submarket": "South Hillsborough",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 180000,
    "available_sf": 12900,
    "vacancy_rate": "7.2%",
    "asking_rent": "$11.89",
    "year_built": 1988,
    "stories": 1,
    "lot_size": 13.3,
    "clear_height": 32,
    "dock_doors": 12,
    "drive_in_doors": 1,
    "zoning": "PD",
    "parking": 138,
    "owner": "Highwoods Properties",
    "broker_notes": "Heavy power available (2,000 amps). Reinforced slab floor.",
    "latitude": 28.0025,
    "longitude": -82.368,
    "summary": "A sizable office property (13.3-acre, 180,000 SF) in Tampa (South Hillsborough County). Heavy power available (2,000 amps). Reinforced slab floor."
  },
  {
    "name": "Lakeland Central Distribution",
    "address": "4500 Drane Field Rd",
    "city": "Lakeland",
    "state": "FL",
    "zip": "33811",
    "submarket": "Lakeland/I-4",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 42000,
    "available_sf": 6779,
    "vacancy_rate": "16.1%",
    "asking_rent": "$8.56",
    "year_built": 2013,
    "stories": 1,
    "lot_size": 2.6,
    "clear_height": 36,
    "dock_doors": 2,
    "drive_in_doors": 1,
    "zoning": "CI",
    "parking": 21,
    "owner": "FL Warehouse Partners",
    "broker_notes": "Divisible to 15,000 SF. Flexible lease terms available.",
    "latitude": 27.996485,
    "longitude": -82.039389,
    "summary": "An office property (2.6-acre, 42,000 SF) in Lakeland (Lakeland/I-4 County). Divisible to 15,000 SF. Flexible lease terms available."
  },
  {
    "name": "Polk Commerce Centre",
    "address": "1825 Harden Blvd",
    "city": "Lakeland",
    "state": "FL",
    "zip": "33803",
    "submarket": "Lakeland/I-4",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 42000,
    "available_sf": 8927,
    "vacancy_rate": "21.3%",
    "asking_rent": "$10.47",
    "sale_price": "$5,880,000",
    "cap_rate": "8.21%",
    "year_built": 1995,
    "stories": 1,
    "lot_size": 3.1,
    "clear_height": 32,
    "dock_doors": 2,
    "drive_in_doors": 2,
    "zoning": "PD",
    "parking": 50,
    "owner": "Suncoast Ventures",
    "broker_notes": "Food-grade certified. Temperature-controlled zones available.",
    "latitude": 28.0217131,
    "longitude": -81.9737769,
    "summary": "An office property (3.1-acre, 42,000 SF) in Lakeland (Lakeland/I-4 County). Food-grade certified. Temperature-controlled zones available."
  },
  {
    "name": "I-4 Logistics Crossing",
    "address": "6945 US Hwy 98 N",
    "city": "Lakeland",
    "state": "FL",
    "zip": "33809",
    "submarket": "Lakeland/I-4",
    "property_type": "Industrial",
    "building_class": "C",
    "total_sf": 210000,
    "available_sf": 57184,
    "vacancy_rate": "27.2%",
    "asking_rent": "$12.43",
    "year_built": 2003,
    "stories": 1,
    "lot_size": 12.8,
    "clear_height": 28,
    "dock_doors": 3,
    "drive_in_doors": 3,
    "zoning": "IL",
    "parking": 120,
    "owner": "Prologis",
    "broker_notes": "Recently renovated dock area. Owner motivated on long-term lease.",
    "latitude": 28.105349,
    "longitude": -81.9736227,
    "summary": "A mid-size office property (12.8-acre, 210,000 SF) in Lakeland (Lakeland/I-4 County). Recently renovated dock area. Owner motivated on long-term lease."
  },
  {
    "name": "Gateway Center Industrial",
    "address": "9190 16th St N",
    "city": "St. Petersburg",
    "state": "FL",
    "zip": "33716",
    "submarket": "Pinellas",
    "property_type": "Industrial",
    "building_class": "C",
    "total_sf": 120000,
    "available_sf": 28885,
    "vacancy_rate": "24.1%",
    "asking_rent": "$14.08",
    "year_built": 1988,
    "stories": 1,
    "lot_size": 9.7,
    "clear_height": 36,
    "dock_doors": 3,
    "drive_in_doors": 1,
    "zoning": "CI",
    "parking": 68,
    "owner": "Industrial Logistics Properties Trust",
    "broker_notes": "Heavy power available (2,000 amps). Reinforced slab floor.",
    "latitude": 27.8702631,
    "longitude": -82.6552262,
    "summary": "A sizable office property (9.7-acre, 120,000 SF) in St. Petersburg (Pinellas County). Heavy power available (2,000 amps). Reinforced slab floor."
  },
  {
    "name": "Pinellas Park Flex Warehouse",
    "address": "5601 72nd Ave N",
    "city": "Pinellas Park",
    "state": "FL",
    "zip": "33781",
    "submarket": "Pinellas",
    "property_type": "Industrial",
    "building_class": "B",
    "total_sf": 35000,
    "available_sf": 14932,
    "vacancy_rate": "42.7%",
    "asking_rent": "$11.2",
    "year_built": 2024,
    "stories": 1,
    "lot_size": 2.3,
    "clear_height": 24,
    "dock_doors": 3,
    "drive_in_doors": 3,
    "zoning": "IL",
    "parking": 36,
    "owner": "Industrial Logistics Properties Trust",
    "broker_notes": "Below-market asking rate. Landlord offering TI allowance.",
    "latitude": 27.8373774,
    "longitude": -82.6949542,
    "summary": "An office property (2.3-acre, 35,000 SF) in Pinellas Park (Pinellas County). Below-market asking rate. Landlord offering TI allowance."
  },
  {
    "name": "Clearwater Commerce Bldg B",
    "address": "14020 Roosevelt Blvd",
    "city": "Clearwater",
    "state": "FL",
    "zip": "33762",
    "submarket": "Pinellas",
    "property_type": "Industrial",
    "building_class": "A",
    "total_sf": 180000,
    "available_sf": 31621,
    "vacancy_rate": "17.6%",
    "asking_rent": "$8.69",
    "year_built": 2014,
    "stories": 1,
    "lot_size": 12.2,
    "clear_height": 30,
    "dock_doors": 4,
    "drive_in_doors": 1,
    "zoning": "M-1",
    "parking": 115,
    "owner": "Industrial Logistics Properties Trust",
    "broker_notes": "Adjacent parcel available for expansion up to 5 acres.",
    "latitude": 27.858,
    "longitude": -82.728,
    "summary": "A sizable office property (12.2-acre, 180,000 SF) in Clearwater (Pinellas County). Adjacent parcel available for expansion up to 5 acres."
  }
];

let activeFilter = 'all';
let activePropertyIndex = null;
let markers = [];

const map = L.map('map', { zoomControl: true, attributionControl: true });
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors &copy; CARTO', maxZoom: 19, subdomains: 'abcd'
}).addTo(map);
map.zoomControl.setPosition('topright');

function formatSF(n) {
  if (!n) return null;
  var num = typeof n === 'string' ? parseInt(n.replace(/[^0-9]/g, '')) : n;
  return isNaN(num) ? null : num.toLocaleString();
}
function escapeHtml(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// Build filter pills
var submarkets = [];
var seen = {};
PROPERTIES.forEach(function(p) {
  if (p.submarket && !seen[p.submarket]) { seen[p.submarket] = true; submarkets.push(p.submarket); }
});
submarkets.sort();
var pillsContainer = document.getElementById('filterPills');
submarkets.forEach(function(sm) {
  var pill = document.createElement('div');
  pill.className = 'filter-pill';
  pill.dataset.filter = sm;
  pill.textContent = sm;
  pill.addEventListener('click', function() { setFilter(sm); });
  pillsContainer.appendChild(pill);
});
document.querySelector('.filter-pill[data-filter="all"]').addEventListener('click', function() { setFilter('all'); });

function setFilter(filter) {
  activeFilter = filter;
  document.querySelectorAll('.filter-pill').forEach(function(p) {
    p.classList.toggle('active', p.dataset.filter === filter);
  });
  updateVisibility();
  updateStats();
}

function buildPopup(p) {
  var gridItems = '';
  var gridData = [];
  if (p.total_sf) gridData.push({ value: formatSF(p.total_sf), label: 'RBA (SF)' });
  if (p.lot_size) gridData.push({ value: parseFloat(p.lot_size).toFixed(1) + ' ac', label: 'Acres' });
  if (p.tenancy) gridData.push({ value: p.tenancy, label: 'Tenancy' });
  if (p.submarket) gridData.push({ value: p.submarket, label: 'County' });
  if (p.year_built) gridData.push({ value: p.year_built, label: 'Yr Built' });
  if (p.building_class) gridData.push({ value: 'Class ' + p.building_class, label: 'Bldg Class' });
  gridData.slice(0, 6).forEach(function(g) {
    gridItems += '<div class="popup-grid-item"><div class="popup-grid-value">' + g.value + '</div><div class="popup-grid-label">' + g.label + '</div></div>';
  });

  var detailParts = [];
  if (p.sale_price) detailParts.push('Sale Price: <span>' + p.sale_price + '</span>');
  if (p.owner) detailParts.push('Owner: <span>' + escapeHtml(p.owner) + '</span>');
  var detailsHtml = detailParts.length ? '<div class="popup-details">' + detailParts.join(' &nbsp;&bull;&nbsp; ') + '</div>' : '';

  var notesHtml = p.broker_notes ? '<div class="popup-notes"><div class="popup-notes-label">Notes</div>' + escapeHtml(p.broker_notes) + '</div>' : '';
  var imageHtml = p.image_url ? '<div class="popup-image"><img src="' + escapeHtml(p.image_url) + '" alt="' + escapeHtml(p.name) + '"></div>' : '<div class="popup-image"></div>';
  var badge = p.submarket ? '<div class="popup-type-badge">' + escapeHtml(p.submarket) + ' County</div>' : '';

  return imageHtml +
    '<div class="popup-body">' + badge +
    '<div class="popup-name">' + escapeHtml(p.name || p.address) + '</div>' +
    '<div class="popup-address">' + escapeHtml(p.address) + ', ' + escapeHtml(p.city) + ', ' + escapeHtml(p.state) + '</div>' +
    (p.summary ? '<div class="popup-summary">' + escapeHtml(p.summary) + '</div>' : '') +
    (gridItems ? '<div class="popup-grid">' + gridItems + '</div>' : '') +
    detailsHtml + notesHtml +
    '<div class="popup-footer"><span class="popup-footer-brand">Lee &amp; Associates</span><span class="popup-footer-cta">Contact Broker &rarr;</span></div></div>';
}

// Build sidebar cards
var listContainer = document.getElementById('propertyList');
PROPERTIES.forEach(function(p, i) {
  var card = document.createElement('div');
  card.className = 'property-card';
  card.dataset.index = i;
  card.dataset.submarket = p.submarket || '';
  var metricsHtml = '';
  if (p.total_sf) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + formatSF(p.total_sf) + ' SF</div><div class="card-metric-label">RBA</div></div>';
  if (p.lot_size) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + parseFloat(p.lot_size).toFixed(1) + ' ac</div><div class="card-metric-label">Acres</div></div>';
  if (p.tenancy) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + escapeHtml(p.tenancy) + '</div><div class="card-metric-label">Tenancy</div></div>';
  card.innerHTML = '<div class="card-header"><div class="card-name">' + escapeHtml(p.name || p.address) + '</div><div class="card-badge">' + escapeHtml(p.submarket ? p.submarket + ' Co.' : 'Office') + '</div></div>' +
    '<div class="card-address">' + escapeHtml(p.address) + ', ' + escapeHtml(p.city) + '</div>' +
    '<div class="card-metrics">' + metricsHtml + '</div>';
  card.addEventListener('click', function() { selectProperty(i); });
  listContainer.appendChild(card);
});

// Build markers
var markerCluster = L.markerClusterGroup({
  maxClusterRadius: 45, spiderfyOnMaxZoom: true, showCoverageOnHover: false, zoomToBoundsOnClick: true,
  iconCreateFunction: function(cluster) {
    var c = cluster.getChildCount();
    return L.divIcon({
      html: '<div style="width:40px;height:40px;border-radius:50%;background:rgba(0,40,85,0.12);display:flex;align-items:center;justify-content:center"><div style="width:30px;height:30px;border-radius:50%;background:#002855;color:#fff;display:flex;align-items:center;justify-content:center;font-family:DM Sans,sans-serif;font-weight:700;font-size:13px">' + c + '</div></div>',
      className: '', iconSize: [40, 40]
    });
  }
});

PROPERTIES.forEach(function(p, i) {
  if (!p.latitude || !p.longitude) return;
  var icon = L.divIcon({
    className: '',
    html: '<div class="custom-marker pin-animate" style="animation-delay:' + (i * 30) + 'ms" data-index="' + i + '"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></div>',
    iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -18]
  });
  var marker = L.marker([p.latitude, p.longitude], { icon: icon });
  marker.bindPopup(buildPopup(p), { maxWidth: 340, minWidth: 340, closeButton: true });
  marker.on('click', function() { setActiveCard(i); });
  marker.on('popupclose', function() { clearActiveCard(); });
  marker.propertyIndex = i;
  markers.push(marker);
  markerCluster.addLayer(marker);
});
map.addLayer(markerCluster);

if (markers.length > 0) {
  map.fitBounds(L.featureGroup(markers).getBounds().pad(0.1));
}

function selectProperty(index) {
  var p = PROPERTIES[index];
  if (!p.latitude || !p.longitude) return;
  setActiveCard(index);
  map.flyTo([p.latitude, p.longitude], 15, { duration: 1.2 });
  setTimeout(function() {
    var m = markers.find(function(mk) { return mk.propertyIndex === index; });
    if (m) markerCluster.zoomToShowLayer(m, function() { m.openPopup(); });
  }, 1300);
}

function setActiveCard(index) {
  activePropertyIndex = index;
  document.querySelectorAll('.property-card').forEach(function(c) { c.classList.remove('active'); });
  var card = document.querySelector('.property-card[data-index="' + index + '"]');
  if (card) { card.classList.add('active'); card.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
  document.querySelectorAll('.custom-marker').forEach(function(m) { m.classList.remove('active'); });
  var el = document.querySelector('.custom-marker[data-index="' + index + '"]');
  if (el) el.classList.add('active');
}

function clearActiveCard() {
  activePropertyIndex = null;
  document.querySelectorAll('.property-card').forEach(function(c) { c.classList.remove('active'); });
  document.querySelectorAll('.custom-marker').forEach(function(m) { m.classList.remove('active'); });
}

function updateVisibility() {
  var visibleCount = 0;
  document.querySelectorAll('.property-card').forEach(function(card) {
    var idx = parseInt(card.dataset.index);
    var p = PROPERTIES[idx];
    var show = activeFilter === 'all' || p.submarket === activeFilter;
    card.classList.toggle('filtered-out', !show);
    if (show) visibleCount++;
  });
  markers.forEach(function(m) {
    var p = PROPERTIES[m.propertyIndex];
    var show = activeFilter === 'all' || p.submarket === activeFilter;
    var el = document.querySelector('.custom-marker[data-index="' + m.propertyIndex + '"]');
    if (el) el.classList.toggle('faded', !show);
  });
  document.getElementById('emptyState').classList.toggle('visible', visibleCount === 0);
  if (activeFilter !== 'all') {
    var vis = markers.filter(function(m) { return PROPERTIES[m.propertyIndex].submarket === activeFilter; });
    if (vis.length > 0) map.flyToBounds(L.featureGroup(vis).getBounds().pad(0.15), { duration: 1.0 });
  } else {
    map.flyToBounds(L.featureGroup(markers).getBounds().pad(0.1), { duration: 1.0 });
  }
}

function updateStats() {
  var filtered = PROPERTIES.filter(function(p) { return activeFilter === 'all' || p.submarket === activeFilter; });
  var totalSF = filtered.reduce(function(s, p) {
    var n = typeof p.total_sf === 'string' ? parseInt(p.total_sf.replace(/[^0-9]/g, '')) : (p.total_sf || 0);
    return s + (isNaN(n) ? 0 : n);
  }, 0);
  var totalAcres = filtered.reduce(function(s, p) {
    var n = parseFloat(String(p.lot_size || '0').replace(/[^0-9.]/g, ''));
    return s + (isNaN(n) ? 0 : n);
  }, 0);
  document.getElementById('statCount').textContent = filtered.length;
  document.getElementById('statSF').textContent = totalSF.toLocaleString();
  document.getElementById('statAcres').textContent = totalAcres.toFixed(1);
}

var isMobile = window.matchMedia('(max-width: 768px)').matches;
window.matchMedia('(max-width: 768px)').addEventListener('change', function(e) { isMobile = e.matches; });

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    map.closePopup();
    clearActiveCard();
    if (isMobile) {
      document.getElementById('mobileBottomCard').classList.remove('visible');
      document.getElementById('mobileListOverlay').classList.remove('visible');
      document.getElementById('mobileListBtn').classList.remove('hidden');
    }
  }
});

(function() {
  if (!isMobile) return;

  var bottomCard = document.getElementById('mobileBottomCard');
  var bottomCardContent = document.getElementById('mobileBottomCardContent');
  var bottomCardClose = document.getElementById('mobileBottomCardClose');
  var listBtn = document.getElementById('mobileListBtn');
  var listOverlay = document.getElementById('mobileListOverlay');
  var listOverlayClose = document.getElementById('mobileListOverlayClose');
  var overlayList = document.getElementById('mobileOverlayList');
  var overlayStats = document.getElementById('mobileOverlayStats');
  var overlayFilters = document.getElementById('mobileOverlayFilters');

  markers.forEach(function(m) {
    m.unbindPopup();
    m.off('click');
    m.on('click', function() {
      showBottomCard(PROPERTIES[m.propertyIndex], m.propertyIndex);
    });
  });

  map.on('click', function() { hideBottomCard(); });

  function showBottomCard(p, index) {
    bottomCardContent.innerHTML = buildPopup(p);
    bottomCard.classList.add('visible');
    listBtn.classList.add('hidden');
    setActiveCard(index);
  }

  function hideBottomCard() {
    bottomCard.classList.remove('visible');
    listBtn.classList.remove('hidden');
    clearActiveCard();
  }

  bottomCardClose.addEventListener('click', function(e) {
    e.stopPropagation();
    hideBottomCard();
  });

  listBtn.addEventListener('click', function() { showListOverlay(); });
  listOverlayClose.addEventListener('click', function() { hideListOverlay(); });

  function showListOverlay() {
    populateOverlay();
    listOverlay.classList.add('visible');
    listBtn.classList.add('hidden');
  }

  function hideListOverlay() {
    listOverlay.classList.remove('visible');
    listBtn.classList.remove('hidden');
  }

  function populateOverlay() {
    updateOverlayStats();
    overlayFilters.innerHTML = '';
    document.querySelectorAll('#filterPills .filter-pill').forEach(function(pill) {
      var clone = pill.cloneNode(true);
      clone.addEventListener('click', function() {
        setFilter(clone.dataset.filter);
        overlayFilters.querySelectorAll('.filter-pill').forEach(function(p) {
          p.classList.toggle('active', p.dataset.filter === clone.dataset.filter);
        });
        refreshOverlayList();
        updateOverlayStats();
      });
      overlayFilters.appendChild(clone);
    });
    refreshOverlayList();
  }

  function updateOverlayStats() {
    overlayStats.innerHTML =
      '<div class="stat-item"><div class="stat-value">' + document.getElementById('statCount').textContent + '</div><div class="stat-label">Properties</div></div>' +
      '<div class="stat-item"><div class="stat-value">' + document.getElementById('statSF').textContent + '</div><div class="stat-label">Total RBA</div></div>' +
      '<div class="stat-item"><div class="stat-value">' + document.getElementById('statAcres').textContent + '</div><div class="stat-label">Total Acres</div></div>';
  }

  function refreshOverlayList() {
    overlayList.innerHTML = '';
    PROPERTIES.forEach(function(p, i) {
      if (activeFilter !== 'all' && p.submarket !== activeFilter) return;
      var card = document.createElement('div');
      card.className = 'property-card';
      var metricsHtml = '';
      if (p.total_sf) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + formatSF(p.total_sf) + ' SF</div><div class="card-metric-label">RBA</div></div>';
      if (p.lot_size) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + parseFloat(p.lot_size).toFixed(1) + ' ac</div><div class="card-metric-label">Acres</div></div>';
      if (p.tenancy) metricsHtml += '<div class="card-metric"><div class="card-metric-value">' + escapeHtml(p.tenancy) + '</div><div class="card-metric-label">Tenancy</div></div>';
      card.innerHTML = '<div class="card-header"><div class="card-name">' + escapeHtml(p.name || p.address) + '</div><div class="card-badge">' + escapeHtml(p.submarket ? p.submarket + ' Co.' : 'Office') + '</div></div>' +
        '<div class="card-address">' + escapeHtml(p.address) + ', ' + escapeHtml(p.city) + '</div>' +
        '<div class="card-metrics">' + metricsHtml + '</div>';
      card.addEventListener('click', function() {
        hideListOverlay();
        if (p.latitude && p.longitude) {
          map.flyTo([p.latitude, p.longitude], 15, { duration: 1.0 });
          setTimeout(function() { showBottomCard(p, i); }, 1100);
        }
      });
      overlayList.appendChild(card);
    });
  }
})();
</script>
</body>
</html>